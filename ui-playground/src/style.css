:root {
  --ui-scale: 1;
  --letterbox: 1;
  --aspect: auto;
  --pad: clamp(12px, 1.8vmin, 22px);
  --bg: #070a14;
  --ink: #f6ead4;
  --muted: #c1b7a0;
  --accent: #d4a454;
  --accent2: #7bd463;
  /* Globe palette */
  --globe-ring: rgba(255,255,255,.16);
  --globe-ring-inner: rgba(255,255,255,.05);
  --globe-sweep-a: rgba(123,212,99,.28);
  --globe-sweep-b: rgba(123,212,99,.18);
  --globe-pulse: rgba(123,212,99,.35);
  --globe-grid: rgba(255,255,255,.06);
  --globe-lights: rgba(255,220,160,.85);
  color-scheme: dark;
}

* { box-sizing: border-box; }
html, body { height: 100%; }
body {
  margin: 0;
  color: var(--ink);
  background: radial-gradient(ellipse at top, #2b3551 0%, #0a0c17 65%, #05060b 100%);
  font-family: 'Spectral', serif;
}

.scanlines { position: fixed; inset: 0; background-image: repeating-linear-gradient(to bottom, rgba(255,255,255,0.04), rgba(255,255,255,0.04) 1px, transparent 1px, transparent 3px); opacity: .25; pointer-events: none; mix-blend-mode: screen; }

.root { display: grid; grid-template-rows: auto 1fr; min-height: 100svh; padding: env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left); gap: var(--pad); transform: scale(var(--ui-scale)); transform-origin: top center; }

.topbar { display: grid; grid-template-columns: 1fr auto auto; align-items: center; gap: var(--pad); padding: calc(var(--pad) * 0.75) var(--pad); background: rgba(9, 12, 21, 0.65); border: 1px solid rgba(212, 164, 84, 0.35); backdrop-filter: blur(6px); }
.brand { font-family: 'Cinzel', serif; letter-spacing: .08em; color: var(--accent); }
.telemetry { display: flex; gap: .5rem; align-items: center; }
.badge { font-size: .8rem; padding: .2rem .5rem; border: 1px solid rgba(212,164,84,.35); }

.canvas { display: grid; place-items: center; padding: var(--pad); }

.stage { width: min(1200px, 92vw); aspect-ratio: var(--aspect, auto); position: relative; overflow: hidden; border: 1px solid rgba(212, 164, 84, 0.35); background: rgba(9,12,21,.6); box-shadow: 0 30px 70px rgba(0,0,0,.6); display: none; }
.stage.active { display: block; }
.stage[aria-hidden="true"] { display: none; }

@supports (aspect-ratio: 16 / 9) { .stage { aspect-ratio: var(--aspect); } }
body.letterbox .stage { background-image: linear-gradient(#000, #000), linear-gradient(#000, #000); background-repeat: no-repeat; background-position: top, bottom; background-size: 100% max(calc((100% - 100%/ (var(--aspect))) / 2), 0px), 100% max(calc((100% - 100%/ (var(--aspect))) / 2), 0px); }

h1,h2,h3 { font-family: 'Cinzel', serif; text-transform: uppercase; letter-spacing: .08em; }

.primary, .secondary, .ghost, .tile { font: inherit; color: inherit; cursor: pointer; border: 1px solid rgba(244,195,109,.55); background: rgba(57, 42, 23, .85); padding: .7rem 1.6rem; letter-spacing: .12em; text-transform: uppercase; }
.primary { background: linear-gradient(180deg, rgba(215,160,74,.85), rgba(108,67,25,.85)); color: #1c120a; }
.secondary { background: rgba(19,17,28,.75); }
.ghost.small { padding: .4rem .8rem; font-size: .85rem; }

.progress { display: grid; grid-auto-flow: column; gap: .75rem; align-items: center; }
.bar { width: clamp(220px, 35vw, 520px); height: 10px; background: rgba(255,255,255,.08); }
.fill { height: 100%; width: 0%; background: var(--accent2); transition: width .5s ease; }
.value { font-variant-numeric: tabular-nums; color: var(--muted); }

.preflight, .uplink, .globe, .arrival { padding: clamp(16px, 3vmin, 32px); height: 100%; }
.preflight { display: grid; grid-template-columns: 1fr 1fr; gap: clamp(12px, 2vmin, 24px); align-items: center; }
.uplink { display: grid; gap: clamp(12px, 2vmin, 24px); align-content: start; }
.uplink header .kicker { color: var(--muted); letter-spacing: .14em; text-transform: uppercase; font-size: .75rem; margin: 0; }
.uplink header h2 { margin: 4px 0; }
.uplink header .status { margin: 0; color: #e8dfcc; }
.uplink .comms { position: relative; height: min(40vmin, 320px); border: 1px solid rgba(215,160,74,.35); background: rgba(12,14,24,.6); overflow: hidden; }
.uplink .comms .vignette { position: absolute; inset: 0; background: radial-gradient(ellipse at center, rgba(0,0,0,0) 45%, rgba(0,0,0,.6) 100%); pointer-events: none; }
.uplink .comms .wave { position: absolute; inset: 0; background:
  repeating-linear-gradient(90deg, rgba(123,212,99,.0) 0 14px, rgba(123,212,99,.12) 14px 16px, rgba(123,212,99,.0) 16px 32px),
  radial-gradient(circle at 0% 50%, rgba(123,212,99,.16) 0, rgba(123,212,99,0) 50%);
  animation: uplink-wave 6s linear infinite;
  mix-blend-mode: screen;
}
@keyframes uplink-wave { 0% { background-position: 0 0, 0 0; } 100% { background-position: 100% 0, 200% 0; } }
.uplink .comms .packets { position: absolute; inset: 0; pointer-events: none; }
.uplink .comms .packet { position: absolute; width: 8px; height: 8px; border-radius: 2px; background: var(--accent2); box-shadow: 0 0 10px rgba(123,212,99,.4); opacity: 0; animation: packet 1.6s linear forwards; }
@keyframes packet { 0% { opacity: 0; transform: translate(-50%, -50%) scale(.8); } 10% { opacity: 1; } 100% { opacity: 0; transform: translate(-50%, -50%) translateX(120%) scale(1.05); } }
.uplink .comms .bars { position: absolute; right: 10px; bottom: 8px; display: grid; grid-auto-flow: column; align-items: end; gap: 4px; }
.uplink .comms .bars span { display: block; width: 6px; background: rgba(255,255,255,.14); }
.uplink .comms .bars .b1 { height: 8px; }
.uplink .comms .bars .b2 { height: 12px; }
.uplink .comms .bars .b3 { height: 16px; }
.uplink .comms .bars .b4 { height: 22px; background: var(--accent2); box-shadow: 0 0 8px rgba(123,212,99,.4); }
.preflight .orbit { position: relative; width: min(56vmin, 460px); aspect-ratio: 1 / 1; }
.preflight .orbit .stars { position: absolute; inset: -10%; background-image:
  radial-gradient(circle at 20% 30%, rgba(255,255,255,.8) 0 1px, transparent 1px),
  radial-gradient(circle at 50% 60%, rgba(255,255,255,.7) 0 1px, transparent 1px),
  radial-gradient(circle at 70% 40%, rgba(255,255,255,.6) 0 1px, transparent 1px),
  radial-gradient(circle at 35% 75%, rgba(255,255,255,.7) 0 1px, transparent 1px);
  opacity: .4; filter: blur(.2px); pointer-events: none;
}
.preflight .orbit .earth-glow { position: absolute; inset: 10%; border-radius: 50%; background: radial-gradient(circle at 45% 60%, rgba(40,120,255,.24), rgba(40,120,255,0) 60%); filter: blur(1px); opacity: .7; pointer-events: none; }
.preflight .orbit .track { position: absolute; inset: 0; border-radius: 50%; border: 2px dashed rgba(255,255,255,.18); box-shadow: inset 0 0 60px rgba(40,120,255,.15); }
.preflight .orbit .progress-ring { position: absolute; inset: 0; border-radius: 50%; mask: radial-gradient(circle at center, transparent 41%, black 42%); background: conic-gradient(var(--accent2) 0deg, rgba(255,255,255,.08) 0deg); transform: rotate(-90deg); }
.preflight .orbit .blips { position: absolute; inset: 0; border-radius: 50%; pointer-events: none; }
.preflight .orbit .blip { position: absolute; width: 6px; height: 6px; border-radius: 50%; background: var(--accent2); box-shadow: 0 0 0 0 rgba(123,212,99,.35); animation: blip 1.2s ease-out forwards; }
@keyframes blip { 0% { opacity: 0; transform: translate(-50%, -50%) scale(.7); box-shadow: 0 0 0 0 rgba(123,212,99,.35); } 25% { opacity: 1; } 100% { opacity: 0; transform: translate(-50%, -50%) scale(1.8); box-shadow: 0 0 18px 16px rgba(123,212,99,0); } }
.preflight .orbit .satellite { position: absolute; width: 16px; height: 16px; background: var(--accent2); border-radius: 50%; animation: orbit 6s linear infinite; box-shadow: 0 0 12px rgba(123,212,99,.45); }
@keyframes orbit { from { transform: rotate(0deg) translateX(45%) rotate(0deg); } to { transform: rotate(360deg) translateX(45%) rotate(-360deg); } }
.preflight .orbit .satellite::after { content: ""; position: absolute; left: -6px; top: 50%; width: 6px; height: 2px; transform: translate(-100%, -50%); background: linear-gradient(90deg, rgba(123,212,99,.0), rgba(123,212,99,.6)); filter: blur(.4px); animation: thruster .25s steps(2, end) infinite; }
@keyframes thruster { 0%, 100% { opacity: .5; } 50% { opacity: 1; } }

.globe .radar { position: relative; width: min(60vmin, 520px); aspect-ratio: 1 / 1; }
.globe { position: relative; width: 100%; display: grid; grid-template-columns: 1fr; place-items: center; }
.globe .vignette { position: absolute; inset: -10%; pointer-events: none; background: radial-gradient(ellipse at center, rgba(0,0,0,0) 40%, rgba(0,0,0,.4) 78%, rgba(0,0,0,.65) 100%); }
.globe .grain { position: absolute; inset: 0; pointer-events: none; opacity: .06; background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="140" height="140" viewBox="0 0 140 140"><filter id="n"><feTurbulence type="fractalNoise" baseFrequency="0.9" numOctaves="2" stitchTiles="stitch"/></filter><rect width="100%" height="100%" filter="url(%23n)" opacity="0.3"/></svg>'); mix-blend-mode: overlay; }
.globe .mesh { position: absolute; inset: 6% 8%; pointer-events: none; background-image: linear-gradient(var(--globe-grid) 1px, transparent 1px), linear-gradient(90deg, var(--globe-grid) 1px, transparent 1px); background-size: 28px 28px, 28px 28px; transform: perspective(600px) rotateX(40deg); opacity: .12; filter: blur(.2px); }
.globe .ring { position: absolute; border-radius: 50%; border: 2px solid var(--globe-ring); box-shadow: inset 0 0 0 1px var(--globe-ring-inner), 0 0 40px rgba(123,212,99,.08); }
.globe .outer { inset: 0; }
.globe .middle { inset: 10%;}
.globe .inner { inset: 20%;}
.globe .sweep { position: absolute; inset: 0; border-radius: 50%; background: conic-gradient(from 0deg, var(--globe-sweep-a) 0 12deg, var(--globe-sweep-b) 12deg 18deg, rgba(123,212,99,0) 18deg 360deg); animation: sweep 3.2s linear infinite; filter: drop-shadow(0 0 10px rgba(123,212,99,.25)); }
@keyframes sweep { to { transform: rotate(360deg); } }

/* Scanning ring (rotating) */
.globe .scan-ring { position: absolute; inset: 8% 8%; border-radius: 50%; border: 1px dashed rgba(123,212,99,.35); animation: scan 6s linear infinite; }
@keyframes scan { to { transform: rotate(360deg); } }

/* Markers for places */
.globe .markers { position: absolute; inset: 18% 18%; }
.globe .marker { position: absolute; transform: translate(-50%, -50%); display: grid; place-items: center; cursor: pointer; }
.globe .marker .dot { width: 7px; height: 7px; border-radius: 50%; background: var(--accent2); box-shadow: 0 0 0 0 var(--globe-pulse); animation: pulse 2.4s ease-out infinite; }
.globe .marker .label { margin-top: 6px; font-size: 12px; color: #e9e2d2; opacity: 0; transform: translateY(-4px); transition: opacity .25s ease, transform .25s ease; text-shadow: 0 1px 0 rgba(0,0,0,.5); white-space: nowrap; }
.globe .marker.active .label { opacity: 0.95; transform: translateY(0); }

/* City lights and contours */
.globe .lights { position: absolute; inset: 16% 16%; pointer-events: none; border-radius: 50%; overflow: hidden; opacity: .45; }
.globe .lights::before { content: ""; position: absolute; inset: 0; background:
  radial-gradient(circle at 60% 62%, var(--globe-lights) 0 0.8px, transparent 1px),
  radial-gradient(circle at 55% 68%, var(--globe-lights) 0 1px, transparent 1.2px),
  radial-gradient(circle at 48% 59%, var(--globe-lights) 0 0.7px, transparent 1px),
  radial-gradient(circle at 64% 55%, var(--globe-lights) 0 0.9px, transparent 1.2px),
  radial-gradient(circle at 52% 64%, var(--globe-lights) 0 0.8px, transparent 1px);
  animation: twinkle 4s ease-in-out infinite alternate;
}
@keyframes twinkle { from { opacity: .4; filter: brightness(.9); } to { opacity: .9; filter: brightness(1.15) drop-shadow(0 0 2px rgba(255,220,160,.4)); } }

.globe .contours { position: absolute; inset: 14% 14%; pointer-events: none; border-radius: 50%; mask: radial-gradient(circle at center, black 0 65%, transparent 66%); opacity: .25; }
.globe .contours::before { content: ""; position: absolute; inset: 0; background:
  repeating-conic-gradient(from 0deg, rgba(255,255,255,.12) 0 1deg, transparent 1deg 6deg),
  repeating-linear-gradient(transparent 0 10px, rgba(255,255,255,.06) 10px 11px);
  mix-blend-mode: screen;
}

.arrival { display: grid; gap: clamp(12px, 2vmin, 24px); }
.arrival .hero { position: relative; height: min(42vmin, 360px); border: 1px solid rgba(215,160,74,.35); background: radial-gradient(ellipse at 50% 85%, rgba(255,255,255,.05), rgba(0,0,0,0) 60%), linear-gradient(180deg, rgba(12,14,24,.75), rgba(12,14,24,.6)); overflow: hidden; }
.arrival .hero .horizon { position: absolute; inset: 0; background: radial-gradient(ellipse at center, rgba(123,212,99,.08), rgba(123,212,99,0) 60%); opacity: .6; pointer-events: none; }
.arrival .hero .overlay { position: absolute; inset: 0; background: radial-gradient(ellipse at center, rgba(0,0,0,0) 45%, rgba(0,0,0,.55)); pointer-events: none; }
.arrival .hero .map { position: absolute; inset: 0; }
.arrival .hero .map .trace { position: absolute; border-radius: 999px; opacity: .55; filter: blur(.2px); }
.arrival .hero .map .trace.river { left: 10%; bottom: 12%; width: 80%; height: 40%; border: 1px solid rgba(90,180,255,.45); transform: rotate(-8deg) skewX(-12deg); border-left: none; border-top: none; }
.arrival .hero .map .trace.chapel { left: 48%; top: 10%; width: 2px; height: 80%; background: linear-gradient(180deg, rgba(255,255,255,.0), rgba(255,255,255,.25)); box-shadow: 0 0 8px rgba(255,255,255,.08); }
.arrival .hero .map .trace.toorak { left: 28%; top: 24%; width: 2px; height: 60%; background: linear-gradient(180deg, rgba(255,255,255,.0), rgba(255,255,255,.18)); transform: rotate(6deg); opacity: .4; }
.arrival .hero .map .node { position: absolute; font-size: .9rem; color: #e9e2d2; text-shadow: 0 1px 0 rgba(0,0,0,.35); }
.arrival .hero .map .node.active, .arrival .hero .map .node.pinned { color: #fff; text-shadow: 0 0 8px rgba(255,255,255,.5); }
.arrival .hero .map .node:nth-of-type(1) { left: 18%; bottom: 18%; }
.arrival .hero .map .node:nth-of-type(2) { left: 52%; top: 18%; }
.arrival .hero .map .node:nth-of-type(3) { left: 62%; top: 42%; }
.arrival .hero .map .node[data-node="South Yarra Station"] { left: 56%; top: 30%; }
.arrival .hero .map .node[data-node="Prahran Market"] { left: 48%; top: 38%; }
.arrival .card.kpis .sparkline { height: 40px; margin-top: .5rem; background: linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,0)); position: relative; overflow: hidden; }
.arrival .card.kpis .kpi-actions { margin-top: .5rem; display: flex; gap: 8px; }
.arrival .card.kpis[data-live="true"] { border-color: rgba(123,212,99,.55); box-shadow: 0 0 0 1px rgba(123,212,99,.2) inset; }
.arrival .card.signals .chips { display: flex; flex-wrap: wrap; gap: 6px; }
.arrival .card.signals .chip { background: rgba(20,21,36,.7); border: 1px solid rgba(215,160,74,.35); padding: .35rem .6rem; font: inherit; color: inherit; cursor: pointer; }
.arrival .card.signals .chip.active { background: var(--accent2); color: #0f130f; border-color: transparent; }
.arrival .card.signals .mini-bars { margin-top: .6rem; display: grid; grid-template-columns: repeat(8, 1fr); align-items: end; gap: 4px; height: 60px; background: rgba(255,255,255,.04); padding: 6px; }
.arrival .card.signals .mini-bars span { display: block; width: 100%; background: var(--accent2); opacity: .85; }
.arrival .hero .map .tram { position: absolute; width: 10px; height: 10px; border-radius: 2px; background: var(--accent2); left: 48%; top: 16%; box-shadow: 0 0 6px rgba(123,212,99,.4); animation: tram-move 8s linear infinite; }
@keyframes tram-move { 0% { transform: translate(-50%, 0); opacity: .8; } 45% { opacity: 1; } 100% { transform: translate(-50%, 68vh); opacity: .2; } }
.arrival .watermark { position: absolute; right: 2%; bottom: 4%; letter-spacing: .4em; font-size: clamp(22px, 6vmin, 54px); color: rgba(255,255,255,.05); pointer-events: none; }
.arrival .hero .copy { position: absolute; left: 6%; top: 10%; max-width: 540px; }
.arrival .hero .copy .kicker { letter-spacing: .14em; text-transform: uppercase; color: var(--muted); margin: 0 0 4px; }
.arrival .hero .copy h2 { margin: 0 0 4px; }
.arrival .hero .copy .stats { display: flex; flex-wrap: wrap; gap: 6px; margin-top: 6px; }
.arrival .grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: clamp(12px, 2vmin, 24px); }
.arrival .card { background: rgba(20,21,36,.7); padding: 1rem; border: 1px solid rgba(215, 160, 74, 0.35); transition: transform .18s ease, box-shadow .18s ease, border-color .18s ease; }
.arrival .card:hover { transform: translateY(-2px); box-shadow: 0 10px 26px rgba(0,0,0,.35); border-color: rgba(215,160,74,.6); }
.arrival .card ul { margin: .5rem 0 0; padding-left: 1rem; }
.arrival .card ul li { margin: .25rem 0; }
.arrival .card.systems .system-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; }
.arrival .card.systems .sys .label { color: var(--muted); font-size: .85rem; }
.arrival .card.systems .sys .value { font-variant-numeric: tabular-nums; }
.arrival .card.systems .sys .bar { height: 8px; background: rgba(255,255,255,.08); }
.arrival .card.systems .sys .bar span { display: block; height: 100%; background: var(--accent2); }
.arrival .activity .feed { display: grid; gap: 6px; padding-left: 0; list-style: none; }
.arrival .activity .feed .time { font-variant-numeric: tabular-nums; color: var(--muted); margin-right: 6px; }
.arrival .modes { display: grid; grid-auto-flow: column; gap: 8px; justify-content: start; }
.arrival .modes .tile { background: rgba(20,21,36,.7); border: 1px solid rgba(215,160,74,.35); padding: .6rem 1rem; letter-spacing: .1em; }
.arrival .modes .tile.active { background: linear-gradient(180deg, rgba(215,160,74,.85), rgba(108,67,25,.85)); color: #1c120a; border-color: rgba(215,160,74,.7); }
.arrival .actions { display: grid; grid-auto-flow: column; gap: 8px; justify-content: start; }

.modal[aria-hidden="true"] { display: none; }
.modal[aria-hidden="false"] { display: block; position: fixed; inset: 0; z-index: 50; }
.modal .backdrop { position: absolute; inset: 0; background: rgba(4,5,12,.75); }
.modal .dialog { position: relative; margin: 6vh auto; width: min(92vw, 680px); background: rgba(10, 9, 18, .92); border: 1px solid rgba(219,164,76,.45); padding: 1rem; outline: none; }

.settings { display: grid; gap: .75rem; }
.settings .row { display: flex; gap: .5rem; align-items: center; }

@media (prefers-reduced-motion: reduce) { .preflight .orbit .satellite, .globe .sweep { animation: none; } .fill { transition: none; } .globe .lights::before { animation: none; } }

/* Caption refinements */
.globe .caption { margin-top: 14px; text-align: center; max-width: 720px; }
.globe .caption .step { letter-spacing: .18em; text-transform: uppercase; font-size: .8rem; color: color-mix(in oklab, var(--muted), #fff 8%); margin: 0 0 4px; opacity: .9; }
.globe .caption .detail { margin: 0; color: #e8dfcc; text-shadow: 0 1px 0 rgba(0,0,0,.35); }

/* Beacon focus point */
.globe .beacon { position: absolute; width: 10px; height: 10px; border-radius: 50%; background: var(--accent2); left: 52%; top: 58%; transform: translate(-50%, -50%); box-shadow: 0 0 0 0 var(--globe-pulse); animation: pulse 2.4s ease-out infinite; }
@keyframes pulse { 0% { box-shadow: 0 0 0 0 rgba(123,212,99,.35); } 70% { box-shadow: 0 0 0 14px rgba(123,212,99,0); } 100% { box-shadow: 0 0 0 0 rgba(123,212,99,0); } }

/* Parallax hooks for map layers */
.globe .map { position: absolute; inset: 18% 18%; pointer-events: none; }
.globe .map > * { position: absolute; inset: 0; transition: transform .2s ease; }
.globe .map .aus { opacity: .18; }
.globe .map .vic { opacity: .22; }
.globe .map .melb { opacity: .35; }

/* Melbourne SVG overlay styling */
.globe .map .melb-svg { width: 100%; height: 100%; opacity: .55; filter: url(#glow); }
.globe .map .melb-svg .yarra { fill: none; stroke: rgba(90, 180, 255, .6); stroke-width: 1.6; filter: url(#glow); }
.globe .map .melb-svg .cbd { fill: rgba(255,255,255,.06); stroke: rgba(255,255,255,.18); }
.globe .map .melb-svg .grid { stroke: rgba(255,255,255,.08); stroke-width: .6; }
